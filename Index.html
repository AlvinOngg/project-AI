<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Grid with Highlight</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      #rumahNya {
        position: relative;
        width: 630px; /* 9 kolom x 70px */
        height: 350px; /* 5 baris x 70px */
        background-color: #f0f0f0;
        border: 2px solid #ccc;
      }
      .node {
        position: absolute;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background-color: yellow;
        border: 1px solid black;
        text-align: center;
        line-height: 45px;
      }
      #highlight {
        position: absolute;
        width: 210px; /* 3 kolom x 70px */
        height: 210px; /* 3 baris x 70px */
        background-color: rgba(0, 128, 255, 0.3);
        pointer-events: none; /* Highlight tidak menghalangi klik */
        display: none; /* Sembunyikan saat tidak digunakan */
        z-index: 100; /* Pastikan di atas grid */
      }
      #turnInfo {
        margin-bottom: 10px;
        font-size: 18px;
        font-weight: bold;
        color: #333;
      }
    </style>
  </head>
  <body>
    <div id="turnInfo">Giliran: Pemain 1 (Orang)</div>
    <div id="rumahNya">
      <div id="highlight"></div>
    </div>
    <script>
      const cellSize = 70; // Ukuran kotak grid (70px x 70px)
      const jmlNode = Array(5)
        .fill(null)
        .map(() =>
          Array(9)
            .fill(null)
            .map(() => ({ type: "" }))
        );

      let turn = 1; // Menandai giliran (1 = giliran pertama)
      let macanX = 0;
      let macanY = 0;

      $(document).ready(() => {
        gambarUlang();

        // Tambahkan highlight area
        const $highlight = $("#highlight");

        $("#rumahNya").on("mousemove", (e) => {
          if (turn === 1) {
            // Hanya tampilkan highlight jika bukan giliran pertama
            const rect = e.currentTarget.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            const x = Math.floor(mouseX / cellSize);
            const y = Math.floor(mouseY / cellSize);

            // Validasi agar highlight hanya muncul dalam area 3x3 kotak merah
            if (
              x >= 3 &&
              x <= 5 &&
              y >= 1 &&
              y <= 3 &&
              x + 3 <= 9 &&
              y + 3 <= 6
            ) {
              $highlight.css({
                top: y * cellSize - cellSize + "px",
                left: x * cellSize - cellSize + "px",
                display: "block",
              });
            } else {
              $highlight.hide();
            }
          }
        });

        $("#rumahNya").on("mouseleave", () => {
          $highlight.hide(); // Sembunyikan saat kursor keluar
        });
      });

      function updateTurnInfo() {
        const turnInfo = $("#turnInfo");
        if (turn % 2 === 1) {
          turnInfo.text("Giliran: Pemain 1 (Orang)");
        } else {
          turnInfo.text("Giliran: Pemain 2 (Macan)");
        }
      }

      function gambarUlang() {
        $("#rumahNya").html(""); // Reset konten
        $("#rumahNya").append('<div id="highlight"></div>'); // Tambahkan kembali elemen highlight
        for (let i = 0; i < 5; i++) {
          for (let j = 0; j < 9; j++) {
            if (
              !(
                (i == 0 && j == 1) ||
                (i == 4 && j == 1) ||
                (i == 1 && j == 0) ||
                (i == 3 && j == 0) ||
                (i == 1 && j == 8) ||
                (i == 3 && j == 8) ||
                (i == 4 && j == 7) ||
                (i == 0 && j == 7)
              )
            ) {
              // Periksa tipe node
              if (jmlNode[i][j].type == "Orang") {
                $("#rumahNya").append(
                  `<div onclick='cekGame(${i}, ${j})' style='top:${
                    i * cellSize
                  }px; background-image: url("man.png"); background-size:cover; left:${
                    j * cellSize
                  }px;' class='node'></div>`
                );
              } else if (jmlNode[i][j].type == "Macan") {
                $("#rumahNya").append(
                  `<div onclick='cekGame(${i}, ${j})' style='top:${
                    i * cellSize
                  }px; background-image: url("tiger.png"); background-size:cover; left:${
                    j * cellSize
                  }px;' class='node'></div>`
                );
              } else {
                $("#rumahNya").append(
                  `<div onclick='cekGame(${i}, ${j})' style='top:${
                    i * cellSize
                  }px; left:${j * cellSize}px;' class='node'></div>`
                );
              }
            }
          }
        }
      }

      function cekGame(i, j) {
        const highlightX = parseInt($("#highlight").css("left")) / cellSize;
        const highlightY = parseInt($("#highlight").css("top")) / cellSize;

        if (i < 0 || i >= 5 || j < 0 || j >= 9) {
          alert("Koordinat di luar grid.");
          return;
        }

        if (turn === 1) {
          for (let y = highlightY; y < highlightY + 3; y++) {
            for (let x = highlightX; x < highlightX + 3; x++) {
              if (y >= 0 && y < 5 && x >= 0 && x < 9) {
                jmlNode[y][x].type = "Orang";
              }
            }
          }
          turn++;
        } else {
          if (turn % 2 === 1) {
            if (jmlNode[i][j].type === "") {
              jmlNode[i][j].type = "Orang";
            } else {
              alert("Posisi sudah terisi!");
              return;
            }
          } else {
            if (macanX === 0 && macanY === 0) {
              jmlNode[i][j].type = "Macan";
              macanX = i;
              macanY = j;
            } else {
              if (jmlNode[i][j].type === "") {
                jmlNode[macanX][macanY].type = "";
                jmlNode[i][j].type = "Macan";
                macanX = i;
                macanY = j;
              } else {
                alert("Posisi sudah terisi!");
                return;
              }
            }
          }
          turn++;
        }

        updateTurnInfo();
        gambarUlang();
      }
    </script>
  </body>
</html>
