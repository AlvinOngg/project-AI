<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Catur Macanan Tradisional</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      #rumahNya {
        position: relative;
        width: 630px; /* 9 kolom x 70px */
        height: 350px; /* 5 baris x 70px */
        background-color: #f0f0f0;
        border: 2px solid #ccc;
      }
      .node {
        position: absolute;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background-color: yellow;
        border: 1px solid black;
        text-align: center;
        line-height: 45px;
      }
      #highlight {
        position: absolute;
        width: 210px; /* 3 kolom x 70px */
        height: 210px; /* 3 baris x 70px */
        background-color: rgba(0, 128, 255, 0.3);
        pointer-events: none; /* Highlight tidak menghalangi klik */
        display: none; /* Sembunyikan saat tidak digunakan */
        z-index: 100; /* Pastikan di atas grid */
      }
      #turnInfo {
        margin-bottom: 10px;
        font-size: 18px;
        font-weight: bold;
        color: #333;
      }
    </style>
  </head>
  <body>
    <div id="turnInfo">Giliran: Pemain 1 (Orang)</div>
    <br />
    <div id="pion">Jumlah Pion: 21</div>
    <br />
    <div id="eatenPion">Pion yang dimakan: 0</div>
    <div id="rumahNya">
      <canvas id="canvasLayer"></canvas>
      <div id="highlight"></div>
    </div>
    <script>
      // Definisi Kelas classNode
      class classNode {
        constructor(x, y, id) {
          this.id = id;
          this.type = ""; // Default kosong
          this.topNode = null;
          this.bottomNode = null;
          this.leftNode = null;
          this.rightNode = null;
          this.topRightNode = null;
          this.topLeftNode = null;
          this.bottomLeftNode = null;
          this.bottomRightNode = null;
          this.arrNode = [
            this.topNode,
            this.bottomNode,
            this.leftNode,
            this.rightNode,
            this.topRightNode,
            this.topLeftNode,
            this.bottomLeftNode,
            this.bottomRightNode,
          ];
          this.x = x;
          this.y = y;
        }
        updateArrNode() {
          this.arrNode = [
            this.topNode,
            this.bottomNode,
            this.leftNode,
            this.rightNode,
            this.topRightNode,
            this.topLeftNode,
            this.bottomLeftNode,
            this.bottomRightNode,
          ];
        }
      }

      const cellSize = 70;
      const jmlNode = Array(5)
        .fill(null)
        .map((_, y) =>
          Array(9)
            .fill(null)
            .map((_, x) => new classNode(x, y, `${x}-${y}`))
        );

      let turn = 1;
      let macanX = 0;
      let macanY = 0;
      let jumlahPion = 21;
      let eatenPion = 0;
      let firstClick = true;
      let pionX = 0;
      let pionY = 0;

      $(document).ready(() => {
        jmlNode[0][0].bottomNode = jmlNode[0][1];
        jmlNode[0][0].bottomRightNode = jmlNode[1][1];
        jmlNode[2][0].topNode = jmlNode[0][0];
        jmlNode[2][0].bottomNode = jmlNode[4][0];
        jmlNode[2][0].rightNode = jmlNode[2][1];
        jmlNode[2][0].topLeftNode = null;
        jmlNode[2][0].bottomLeftNode = null;
        jmlNode[4][0].topNode = jmlNode[2][0];
        jmlNode[4][0].bottomNode = null;
        jmlNode[4][0].leftNode = null;
        jmlNode[4][0].rightNode = null;
        jmlNode[4][0].topRightNode = jmlNode[3][1];
        jmlNode[4][0].topLeftNode = null;
        jmlNode[4][0].bottomLeftNode = null;
        jmlNode[4][0].bottomRightNode = null;
        jmlNode[1][1].topNode = null;
        jmlNode[1][1].bottomNode = jmlNode[2][1];
        jmlNode[1][1].leftNode = null;
        jmlNode[1][1].rightNode = null;
        jmlNode[1][1].topRightNode = null;
        jmlNode[1][1].topLeftNode = jmlNode[0][0];
        jmlNode[1][1].bottomRightNode = jmlNode[2][2];
        jmlNode[2][1].topNode = jmlNode[1][1];
        jmlNode[2][1].bottomNode = jmlNode[3][1];
        jmlNode[2][1].leftNode = jmlNode[2][0];
        jmlNode[2][1].rightNode = jmlNode[2][2];
        jmlNode[2][1].topRightNode = null;
        jmlNode[2][1].topLeftNode = null;
        jmlNode[2][1].bottomLeftNode = null;
        jmlNode[2][1].bottomRightNode = null;
        jmlNode[3][1].topNode = jmlNode[2][1];
        jmlNode[3][1].bottomNode = null;
        jmlNode[3][1].leftNode = null;
        jmlNode[3][1].rightNode = null;
        jmlNode[3][1].topRightNode = jmlNode[2][2];
        jmlNode[3][1].bottomLeftNode = jmlNode[4][0];
        jmlNode[3][1].bottomRightNode = null;
        jmlNode[0][2].topNode = null;
        jmlNode[0][2].bottomNode = jmlNode[1][2];
        jmlNode[0][2].leftNode = null;
        jmlNode[0][2].rightNode = jmlNode[0][3];
        jmlNode[0][2].topRightNode = null;
        jmlNode[0][2].topLeftNode = null;
        jmlNode[0][2].bottomLeftNode = null;
        jmlNode[0][2].bottomRightNode = jmlNode[1][3];
        jmlNode[1][2].topNode = jmlNode[0][2];
        jmlNode[1][2].bottomNode = jmlNode[2][2];
        jmlNode[1][2].leftNode = null;
        jmlNode[1][2].rightNode = jmlNode[1][3];
        jmlNode[2][2].topNode = jmlNode[1][2];
        jmlNode[2][2].bottomNode = jmlNode[3][2];
        jmlNode[2][2].leftNode = jmlNode[2][1];
        jmlNode[2][2].rightNode = jmlNode[2][3];
        jmlNode[2][2].topRightNode = jmlNode[1][3];
        jmlNode[2][2].topLeftNode = jmlNode[1][1];
        jmlNode[2][2].bottomLeftNode = jmlNode[3][1];
        jmlNode[2][2].bottomRightNode = jmlNode[3][3];
        jmlNode[3][2].topNode = jmlNode[2][2];
        jmlNode[3][2].bottomNode = jmlNode[4][2];
        jmlNode[3][2].leftNode = null;
        jmlNode[3][2].rightNode = jmlNode[3][3];
        jmlNode[4][2].topNode = jmlNode[3][2];
        jmlNode[4][2].bottomNode = null;
        jmlNode[4][2].leftNode = null;
        jmlNode[4][2].rightNode = jmlNode[4][3];
        jmlNode[4][2].topRightNode = jmlNode[3][3];
        jmlNode[4][2].topLeftNode = null;
        jmlNode[4][2].bottomLeftNode = null;
        jmlNode[4][2].bottomRightNode = null;
        jmlNode[0][3].topNode = null;
        jmlNode[0][3].bottomNode = jmlNode[1][3];
        jmlNode[0][3].leftNode = jmlNode[0][2];
        jmlNode[0][3].rightNode = jmlNode[0][4];
        jmlNode[1][3].topNode = jmlNode[0][3];
        jmlNode[1][3].bottomNode = jmlNode[2][3];
        jmlNode[1][3].leftNode = jmlNode[1][2];
        jmlNode[1][3].rightNode = jmlNode[1][4];
        jmlNode[1][3].topRightNode = jmlNode[0][4];
        jmlNode[1][3].topLeftNode = jmlNode[0][2];
        jmlNode[1][3].bottomLeftNode = jmlNode[2][2];
        jmlNode[1][3].bottomRightNode = jmlNode[2][4];
        jmlNode[2][3].topNode = jmlNode[1][3];
        jmlNode[2][3].bottomNode = jmlNode[3][3];
        jmlNode[2][3].leftNode = jmlNode[2][2];
        jmlNode[2][3].rightNode = jmlNode[2][4];
        jmlNode[3][3].topNode = jmlNode[2][3];
        jmlNode[3][3].bottomNode = jmlNode[4][3];
        jmlNode[3][3].leftNode = jmlNode[3][2];
        jmlNode[3][3].rightNode = jmlNode[3][4];
        jmlNode[3][3].topRightNode = jmlNode[2][4];
        jmlNode[3][3].topLeftNode = jmlNode[2][2];
        jmlNode[3][3].bottomLeftNode = jmlNode[4][2];
        jmlNode[3][3].bottomRightNode = jmlNode[4][4];
        jmlNode[4][3].topNode = jmlNode[3][3];
        jmlNode[4][3].bottomNode = null;
        jmlNode[4][3].leftNode = jmlNode[4][2];
        jmlNode[4][3].rightNode = jmlNode[4][4];
        jmlNode[0][4].topNode = null;
        jmlNode[0][4].bottomNode = jmlNode[1][4];
        jmlNode[0][4].leftNode = jmlNode[0][3];
        jmlNode[0][4].rightNode = jmlNode[0][5];
        jmlNode[0][4].topRightNode = null;
        jmlNode[0][4].topLeftNode = null;
        jmlNode[0][4].bottomLeftNode = jmlNode[1][3];
        jmlNode[0][4].bottomRightNode = jmlNode[1][5];
        jmlNode[1][4].topNode = jmlNode[0][4];
        jmlNode[1][4].bottomNode = jmlNode[2][4];
        jmlNode[1][4].leftNode = jmlNode[1][3];
        jmlNode[1][4].rightNode = jmlNode[1][5];
        jmlNode[2][4].topNode = jmlNode[1][4];
        jmlNode[2][4].bottomNode = jmlNode[3][4];
        jmlNode[2][4].leftNode = jmlNode[2][3];
        jmlNode[2][4].rightNode = jmlNode[2][5];
        jmlNode[2][4].topRightNode = jmlNode[1][5];
        jmlNode[2][4].topLeftNode = jmlNode[1][3];
        jmlNode[2][4].bottomLeftNode = jmlNode[3][3];
        jmlNode[2][4].bottomRightNode = jmlNode[3][5];
        jmlNode[3][4].topNode = jmlNode[2][4];
        jmlNode[3][4].bottomNode = jmlNode[4][4];
        jmlNode[3][4].leftNode = jmlNode[3][3];
        jmlNode[3][4].rightNode = jmlNode[3][5];
        jmlNode[4][4].topNode = jmlNode[3][4];
        jmlNode[4][4].bottomNode = null;
        jmlNode[4][4].leftNode = jmlNode[4][3];
        jmlNode[4][4].rightNode = jmlNode[4][5];
        jmlNode[4][4].topRightNode = jmlNode[3][5];
        jmlNode[4][4].topLeftNode = jmlNode[3][3];
        jmlNode[4][4].bottomLeftNode = null;
        jmlNode[4][4].bottomRightNode = null;
        jmlNode[0][5].topNode = null;
        jmlNode[0][5].bottomNode = jmlNode[1][5];
        jmlNode[0][5].leftNode = jmlNode[0][4];
        jmlNode[0][5].rightNode = jmlNode[0][6];
        jmlNode[1][5].topNode = jmlNode[0][5];
        jmlNode[1][5].bottomNode = jmlNode[2][5];
        jmlNode[1][5].leftNode = jmlNode[1][4];
        jmlNode[1][5].rightNode = jmlNode[1][6];
        jmlNode[1][5].topRightNode = jmlNode[0][6];
        jmlNode[1][5].topLeftNode = jmlNode[0][4];
        jmlNode[1][5].bottomLeftNode = jmlNode[2][4];
        jmlNode[1][5].bottomRightNode = jmlNode[2][6];
        jmlNode[2][5].topNode = jmlNode[1][5];
        jmlNode[2][5].bottomNode = jmlNode[3][5];
        jmlNode[2][5].leftNode = jmlNode[2][4];
        jmlNode[2][5].rightNode = jmlNode[2][6];
        jmlNode[3][5].topNode = jmlNode[2][5];
        jmlNode[3][5].bottomNode = jmlNode[4][5];
        jmlNode[3][5].leftNode = jmlNode[3][4];
        jmlNode[3][5].rightNode = jmlNode[3][6];
        jmlNode[3][5].topRightNode = jmlNode[2][6];
        jmlNode[3][5].topLeftNode = jmlNode[2][4];
        jmlNode[3][5].bottomLeftNode = jmlNode[4][4];
        jmlNode[3][5].bottomRightNode = jmlNode[4][6];
        jmlNode[4][5].topNode = jmlNode[3][5];
        jmlNode[4][5].bottomNode = null;
        jmlNode[4][5].leftNode = jmlNode[4][4];
        jmlNode[4][5].rightNode = jmlNode[4][6];
        jmlNode[0][6].topNode = null;
        jmlNode[0][6].bottomNode = jmlNode[1][6];
        jmlNode[0][6].leftNode = jmlNode[0][5];
        jmlNode[0][6].rightNode = null;
        jmlNode[0][6].topRightNode = null;
        jmlNode[0][6].topLeftNode = null;
        jmlNode[0][6].bottomLeftNode = jmlNode[1][5];
        jmlNode[0][6].bottomRightNode = null;
        jmlNode[1][6].topNode = jmlNode[0][6];
        jmlNode[1][6].bottomNode = jmlNode[2][6];
        jmlNode[1][6].leftNode = jmlNode[1][5];
        jmlNode[1][6].rightNode = null;
        jmlNode[2][6].topNode = jmlNode[1][6];
        jmlNode[2][6].bottomNode = jmlNode[3][6];
        jmlNode[2][6].leftNode = jmlNode[2][5];
        jmlNode[2][6].rightNode = jmlNode[2][7];
        jmlNode[2][6].topRightNode = jmlNode[1][7];
        jmlNode[2][6].topLeftNode = jmlNode[1][5];
        jmlNode[2][6].bottomLeftNode = jmlNode[3][5];
        jmlNode[2][6].bottomRightNode = jmlNode[3][7];
        jmlNode[3][6].topNode = jmlNode[2][6];
        jmlNode[3][6].bottomNode = jmlNode[4][6];
        jmlNode[3][6].leftNode = jmlNode[3][5];
        jmlNode[3][6].rightNode = null;
        jmlNode[4][6].topNode = jmlNode[3][6];
        jmlNode[4][6].bottomNode = null;
        jmlNode[4][6].leftNode = jmlNode[4][5];
        jmlNode[4][6].rightNode = null;
        jmlNode[4][6].topRightNode = null;
        jmlNode[4][6].topLeftNode = jmlNode[3][5];
        jmlNode[4][6].bottomLeftNode = null;
        jmlNode[4][6].bottomRightNode = null;
        jmlNode[0][8].topNode = null;
        jmlNode[0][8].bottomNode = jmlNode[2][8];
        jmlNode[0][8].leftNode = null;
        jmlNode[0][8].rightNode = null;
        jmlNode[0][8].topRightNode = null;
        jmlNode[0][8].topLeftNode = null;
        jmlNode[0][8].bottomLeftNode = jmlNode[1][7];
        jmlNode[0][8].bottomRightNode = null;
        jmlNode[2][8].topNode = jmlNode[0][8];
        jmlNode[2][8].bottomNode = jmlNode[4][8];
        jmlNode[2][8].leftNode = jmlNode[2][7];
        jmlNode[2][8].rightNode = null;
        jmlNode[2][8].topRightNode = null;
        jmlNode[2][8].bottomRightNode = null;
        jmlNode[4][8].topNode = jmlNode[2][8];
        jmlNode[4][8].bottomNode = null;
        jmlNode[4][8].leftNode = null;
        jmlNode[4][8].rightNode = null;
        jmlNode[4][8].topRightNode = null;
        jmlNode[4][8].topLeftNode = jmlNode[3][7];
        jmlNode[4][8].bottomLeftNode = null;
        jmlNode[4][8].bottomRightNode = null;
        jmlNode[1][7].topNode = null;
        jmlNode[1][7].bottomNode = jmlNode[2][7];
        jmlNode[1][7].leftNode = null;
        jmlNode[1][7].rightNode = null;
        jmlNode[1][7].topRightNode = jmlNode[0][8];
        jmlNode[1][7].topLeftNode = null;
        jmlNode[1][7].bottomLeftNode = jmlNode[2][6];
        jmlNode[2][7].topNode = jmlNode[1][7];
        jmlNode[2][7].bottomNode = jmlNode[3][7];
        jmlNode[2][7].leftNode = jmlNode[2][6];
        jmlNode[2][7].rightNode = jmlNode[2][8];
        jmlNode[2][7].topRightNode = null;
        jmlNode[2][7].topLeftNode = null;
        jmlNode[2][7].bottomLeftNode = null;
        jmlNode[2][7].bottomRightNode = null;
        jmlNode[3][7].topNode = jmlNode[2][7];
        jmlNode[3][7].bottomNode = null;
        jmlNode[3][7].leftNode = null;
        jmlNode[3][7].rightNode = null;
        jmlNode[3][7].topLeftNode = jmlNode[2][6];
        jmlNode[3][7].bottomLeftNode = null;
        jmlNode[3][7].bottomRightNode = jmlNode[4][8];

        gambarUlang();

        const $highlight = $("#highlight");
        $("#rumahNya").on("mousemove", (e) => {
          if (turn === 1) {
            const rect = e.currentTarget.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            const x = Math.floor(mouseX / cellSize);
            const y = Math.floor(mouseY / cellSize);

            if (
              x >= 3 &&
              x <= 5 &&
              y >= 1 &&
              y <= 3 &&
              x + 3 <= 9 &&
              y + 3 <= 6
            ) {
              $highlight.css({
                top: y * cellSize - cellSize + "px",
                left: x * cellSize - cellSize + "px",
                display: "block",
              });
            } else {
              $highlight.hide();
            }
          }
        });

        $("#rumahNya").on("mouseleave", () => {
          $highlight.hide();
        });
      });

      function updateTurnInfo() {
        const turnInfo = $("#turnInfo");
        if (turn % 2 === 1) {
          turnInfo.text("Giliran: Pemain 1 (Orang)");
        } else {
          turnInfo.text("Giliran: Pemain 2 (Macan)");
        }
      }

      function gambarUlang() {
        const canvas = document.getElementById("canvasLayer");
        const ctx = canvas.getContext("2d");
        canvas.width = 630; // Lebar grid
        canvas.height = 350; // Tinggi grid

        // Bersihkan canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Gambar garis antara node yang terhubung
        ctx.strokeStyle = "#000"; // Warna garis
        ctx.lineWidth = 2; // Ketebalan garis
        jmlNode.flat().forEach((node) => {
          const { x, y, arrNode } = node;
          const startX = x * cellSize + cellSize / 2;
          const startY = y * cellSize + cellSize / 2;

          arrNode.forEach((neighbor) => {
            if (neighbor) {
              const endX = neighbor.x * cellSize + cellSize / 2;
              const endY = neighbor.y * cellSize + cellSize / 2;
              ctx.beginPath();
              ctx.moveTo(startX, startY);
              ctx.lineTo(endX, endY);
              ctx.stroke();
            }
          });
        });

        // Gambar ulang node
        $("#rumahNya").find(".node, #highlight").remove();
        $("#rumahNya").append('<div id="highlight"></div>');
        jmlNode.flat().forEach((node) => {
          const { x, y, type } = node;
          if (
            !(
              (y == 0 && x == 1) ||
              (y == 4 && x == 1) ||
              (y == 1 && x == 0) ||
              (y == 3 && x == 0) ||
              (y == 1 && x == 8) ||
              (y == 3 && x == 8) ||
              (y == 4 && x == 7) ||
              (y == 0 && x == 7)
            )
          ) {
            let backgroundImage = "";
            if (type == "Orang")
              backgroundImage = 'background-image: url("man.png");';
            else if (type == "Macan")
              backgroundImage = 'background-image: url("tiger.png");';

            $("#rumahNya").append(
              `<div onclick='cekGame(${y}, ${x})' style='top:${
                y * cellSize
              }px; left:${
                x * cellSize
              }px; ${backgroundImage} background-size:cover;' class='node'></div>`
            );
          }
        });
      }

      function updatePion(pion) {
        const pions = $("#pion");
        pions.text("Jumlah Pion: " + pion);
      }

      function updateEatenPion(eaten) {
        const eatenPion = $("#eatenPion");
        eatenPion.text("Pion yang dimakan: " + eaten);
      }

      function cekGerak(posisiAwalX, posisiAwalY, posisiAkhirX, posisiAkhirY) {
        const deltaX = posisiAkhirX - posisiAwalX;
        const deltaY = posisiAkhirY - posisiAwalY;

        if (deltaX === 0 && deltaY === 0) return "Tidak ada gerakan";
        if (deltaX === 0) return deltaY > 0 ? "Kanan" : "Kiri";
        if (deltaY === 0) return deltaX > 0 ? "Bawah" : "Atas";

        return deltaX > 0
          ? deltaY > 0
            ? "Serong Kanan Bawah"
            : "Serong Kiri Bawah"
          : deltaY > 0
          ? "Serong Kanan Atas"
          : "Serong Kiri Atas";
      }

      function MakanManusia(gerak, node, i, j) {
        if (!node || !gerak) return 0;

        const directionMap = {
          Kanan: "rightNode",
          Kiri: "leftNode",
          Atas: "topNode",
          Bawah: "bottomNode",
          "Serong Kanan Atas": "topRightNode",
          "Serong Kiri Atas": "topLeftNode",
          "Serong Kanan Bawah": "bottomRightNode",
          "Serong Kiri Bawah": "bottomLeftNode",
        };

        const direction = directionMap[gerak];
        if (!direction) return 0;

        let count = 0;
        let jarak = 0;
        let currentNode = node[direction];

        if (!currentNode) return "invalid";

        if (currentNode.type === "") {
          let id = j + "-" + i;
          while (currentNode && currentNode.id != id) {
            if (currentNode.type === "") jarak++;
            currentNode = currentNode[direction];
          }
          jarak++;
          return jarak === 1 ? 0 : "invalid";
        } else {
          while (currentNode) {
            if (currentNode.type === "Orang") count++;
            currentNode = currentNode[direction];
          }
        }

        if (count % 2 === 1) {
          currentNode = node[direction];
          while (currentNode) {
            if (currentNode.type === "Orang") currentNode.type = "";
            currentNode = currentNode[direction];
          }
          return count;
        }

        return "invalid";
      }

      function game(i, j) {
        const highlightX = parseInt($("#highlight").css("left")) / cellSize;
        const highlightY = parseInt($("#highlight").css("top")) / cellSize;
        const node = jmlNode[i][j];

        if (turn === 1) {
          for (let y = highlightY; y < highlightY + 3; y++) {
            for (let x = highlightX; x < highlightX + 3; x++) {
              if (y >= 0 && y < 5 && x >= 0 && x < 9) {
                jmlNode[y][x].type = "Orang";
                jumlahPion--;
              }
            }
          }
          turn++;
          return;
        }

        if (turn % 2 === 1) {
          if (jumlahPion !== 0) {
            if (node.type === "") {
              node.type = "Orang";
              jumlahPion--;
            } else {
              alert("Posisi sudah terisi!");
            }
          } else {
            if (firstClick) {
              pionX = i;
              pionY = j;
              firstClick = false;
              turn--;
            } else {
              jmlNode[pionX][pionY].type = "";
              node.type = "Orang";
              firstClick = true;
            }
          }
        } else {
          if (macanX === 0 && macanY === 0) {
            if (node.type === "") {
              node.type = "Macan";
              macanX = i;
              macanY = j;
            } else {
              alert("Posisi sudah terisi!");
            }
          } else {
            if (node.type === "") {
              const tempNode = jmlNode[macanX][macanY];
              const gerak = cekGerak(macanX, macanY, i, j);
              const makan = MakanManusia(gerak, tempNode, i, j);
              if (makan === "invalid") {
                turn--;
              } else {
                jmlNode[macanX][macanY].type = "";
                node.type = "Macan";
                macanX = i;
                macanY = j;
                eatenPion += makan;
              }
            } else {
              alert("Posisi sudah terisi!");
            }
          }
        }
        turn++;
      }

      function cekGame(i, j) {
        if (i < 0 || i >= 5 || j < 0 || j >= 9) {
          alert("Koordinat di luar grid.");
          return;
        }

        game(i, j);

        alert("Posisi : (" + i + "," + j + ")");
        updateTurnInfo();
        updatePion(jumlahPion);
        updateEatenPion(eatenPion);
        gambarUlang();
      }
    </script>
  </body>
</html>
